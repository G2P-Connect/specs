openapi: 3.0.0
info:
  title: G2P Connect payment disbursement APIs
  description: "This is an adaptation of G2P Connect core version 0.1.0. <br><br>
   <b>Overview:</b> <br>  
    1. <b>G2P Connect</b> payment disbursement APIs intent is to enable standrdisation between  social protection and payment processing/rails systems integration<br>
    2. Payment and PaymentStatus are core entities to enable generation of payment instruction and reconcile payment processing status <br>
    3. These entites are common between API and File based data exchange <br>
    4. All dates represented in ISO 8601 format including timezone e.g., 2022-12-04T18:01:07+00:00 <br>
    5. All currency codes represented in ISO 4217 format <br><br>
     
    <b>API Security:</b> <br>  
    1. Considering countries operates G2P schemes using various payment systems for <b>e.g.,</b> central bank payment rails, mobile money networks, directly with govt/private operated financial instituations, etc., the network operating model may vary.<br>
    2. G2P Connect reccommends implementing systems to add <b>additional</b> security measures: <br>
      a. Transport layer security using TLS <br>
      b. End point security using x-access-token issued using client id / secret <br>
      c. Role based access controls <br>
      d. sFTP based solutions for file based exchange <br>
    3. Impelementing systems shall document these as part of operational manuals <br>
    4. x-signature-key in http header enables non-repudiability. <br><br>
    
    <b>Digital Signatures:</b> <br>  
    1. x-signature-key shall hold hash value of the request payload for receiving end point to ensure integrity of the data. <br><br>
    
    <b>TODOs</b>: <br>
      a. Define reversal APIs <br>
      b. Error codes standardisation for each payment status <br>
    "
  version: 0.1.0
  contact:
    name: G2P Connect
    email: info@g2pconnect.global
  license:
   name: G2P Connect License
   url: 'https://github.com/G2P-Connect/specs/blob/main/LICENSE'
tags:
- name: 1. Payment disbursement
- name: 2. Payment disbursement status
paths:
 /v1.0/g2p/payment/disburse:
  post: 
    tags: 
      - 1. Payment disbursement
    summary: "Social protection system initiating g2p payments"
    description: ""
    operationId: post_g2p_payment_disburse
    parameters:
      - $ref: "#/components/parameters/x-request-id"
      - $ref: "#/components/parameters/date"
    requestBody:
      description: ""
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Payment'
    responses:
      '200':
        $ref: "#/components/responses/200SuccessResponse"
      '400':
         $ref: "#/components/responses/400ErrorResponse"
      '500':
         $ref: "#/components/responses/500ErrorResponse"
    security:
      - x-access-token: [ ]
    deprecated: false
 /v1.0/g2p/payment/batch-disburse:
  post: 
    tags: 
      - 1. Payment disbursement
    summary: "Social protection system initiating g2p payments in a batch. Supports both api and .csv file interfaces."
    description: ""
    operationId: post_g2p_payment_batch-disburse
    parameters:
      - $ref: "#/components/parameters/x-request-id"
      - $ref: "#/components/parameters/date"
    requestBody:
      description: ""
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/PaymentBatch'
        multipart/form-data:
          schema:
            $ref: '#/components/schemas/PaymentFile' 
    responses:
      '200':
        $ref: "#/components/responses/200SuccessResponse"
      '400':
         $ref: "#/components/responses/400ErrorResponse"
      '500':
         $ref: "#/components/responses/500ErrorResponse"
    security:
      - x-access-token: [ ]
    deprecated: false
 /v1.0/g2p/payment/status/{transaction_id}:
   get: 
    tags: 
      - 2. Payment disbursement status
    summary: "Get payment disbursement status."
    description: ""
    operationId: get_g2p_payment_status
    parameters:
      - $ref: "#/components/parameters/x-request-id"
      - $ref: "#/components/parameters/date"
      - $ref: "#/components/parameters/accept-language"
      - $ref: "#/components/parameters/transaction_id"
    responses:
      '200':
        description: "Success"
        headers:
          x-request-id:
            $ref: '#/components/headers/x-request-id'
          x-correlation-id:
            $ref: '#/components/headers/x-correlation-id'
          date:
            $ref: "#/components/headers/date"
          x-processing-time:
            $ref: "#/components/headers/x-processing-time"
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PaymentBatchStatus"
      '400':
        $ref: "#/components/responses/400ErrorResponse"
      '500':
        $ref: "#/components/responses/500ErrorResponse"
    security:
      - x-access-token: [ ]
    deprecated: false
 /v1.0/g2p/payment/batch-status/{transaction_id}:
   get: 
    tags: 
      - 2. Payment disbursement status
    summary: "Get payment disbursement batch status."
    description: ""
    operationId: get_g2p_payment_batch-status
    parameters:
      - $ref: "#/components/parameters/x-request-id"
      - $ref: "#/components/parameters/date"
      - $ref: "#/components/parameters/accept-language"
      - $ref: "#/components/parameters/transaction_id"
    responses:
      '200':
        description: "Success"
        headers:
          x-request-id:
            $ref: '#/components/headers/x-request-id'
          x-correlation-id:
            $ref: '#/components/headers/x-correlation-id'
          date:
            $ref: "#/components/headers/date"
          x-processing-time:
            $ref: "#/components/headers/x-processing-time"
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PaymentBatchStatus"
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/PaymentStatusFile"    
      '400':
        $ref: "#/components/responses/400ErrorResponse"
      '500':
        $ref: "#/components/responses/500ErrorResponse"
    security:
      - x-access-token: [ ]
    deprecated: false
 /v1.0/g2p/callback/payment/status:
  post: 
    tags: 
      - 2. Payment disbursement status
    summary: "Social protection system hosted callback to receive payment status updates"
    description: "This end point is hosted by social protection system and called by payment processing/rails to push disbursement status notications"
    operationId: post_g2p_payment_status
    parameters:
      - $ref: "#/components/parameters/x-request-id"
      - $ref: "#/components/parameters/date"
    requestBody:
      description: ""
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/PaymentStatus'
    responses:
      '200':
        $ref: "#/components/responses/200SuccessResponse"
      '400':
         $ref: "#/components/responses/400ErrorResponse"
      '500':
         $ref: "#/components/responses/500ErrorResponse"
    security:
      - x-access-token: [ ]
    deprecated: false
 /v1.0/g2p/callback/payment/batch-status:
  post: 
    tags: 
      - 2. Payment disbursement status
    summary: "Social protection system hosted callback to receive status updates for batch payments. Supports both api and .csv file interfaces."
    description: "This end point is hosted by social protection system and called by payment processing/rails to push disbursement batch status notications"
    operationId: post_g2p_payment_batch-status
    parameters:
      - $ref: "#/components/parameters/x-request-id"
      - $ref: "#/components/parameters/date"
    requestBody:
      description: ""
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/PaymentBatchStatus'
        multipart/form-data:
            schema:
              $ref: "#/components/schemas/PaymentStatusFile"    
    responses:
      '200':
        $ref: "#/components/responses/200SuccessResponse"
      '400':
         $ref: "#/components/responses/400ErrorResponse"
      '500':
         $ref: "#/components/responses/500ErrorResponse"
    security:
      - x-access-token: [ ]
    deprecated: false
components:
  schemas:
    PaymentBatch:
      description: 'Payment list as a collection for bulk processing'
      type: object
      properties:
        header:
          $ref: '#/components/schemas/BatchHeader'
        payments:
          type: array
          items:
            $ref: '#/components/schemas/Payment'
      required:
        - header
        - payments
    PaymentBatchStatus:
      description: 'Payments status list as a collection for bulk processing'
      type: object
      properties:
        header:
          $ref: '#/components/schemas/BatchStatusHeader'
        payments_status:
          type: array
          items:
            $ref: '#/components/schemas/PaymentStatus'
      required:
        - header
        - payments_status
    Payment:
      description: "Describes payment schema that enable transfer from payer to payee accounts. This entity supports immediate and scheduling one time payment request into future. Recurring payments is not part of the scope of this entity."
      type: object
      properties:
        locale:
          $ref: "#/components/schemas/LanguageCode"
        request_id:
          description: 'Unique uuid set by social protect sytem while initiating the payment'
          type: string
        request_datetime: 
          description: 'Payment initiation request data time'
          type: string
          format: date-time
          example: '2022-12-04T18:01:07+00:00'
        scheduled_datetime: 
          description: 'For immediate payments, scheduled_datetime can be same as request_datetime'
          type: string
          format: date-time
          example: '2022-12-04T18:01:07+00:00'
        payer:
          $ref: "#/components/schemas/PaymentAddress"
        payee:
         $ref: "#/components/schemas/PaymentAddress"
        amount:
          $ref: '#/components/schemas/Amount'
        currency:
          $ref: '#/components/schemas/CurrencyCode'
        info:
          description: "Info to payer/payee."
          type: string
          maxLength: 40
        scheme_code:
          description: "G2P social protection system defined scheme short code for easy reference"
          type: string
          maxLength: 40
        additional_info:
          description: "Additional info for interfacing DPGs platforms to integrate, reconcile"
          type: string
          maxLength: 1024
      required:
        - locale
        - request_id
        - date
        - payer
        - payee
        - amount
        - currency
    PaymentStatus:
      description: "Payment disbursement status for reconciliation at social protection system end"
      type: object
      properties:
        locale:
          $ref: "#/components/schemas/LanguageCode"
        reference_code:
          description: 'Unique uuid set by payment sytem while processing the payment'
          type: string
        request_id:
          description: 'Unique uuid set by social protect sytem while initiating the payment'
          type: string
        datetime: 
          description: "Payment status as on date-time"
          type: string
          format: date-time
          example: '2022-12-04T18:01:07+00:00'
        payer:
          $ref: "#/components/schemas/PaymentAddress"
        payee:
         $ref: "#/components/schemas/PaymentAddress"
        amount:
          $ref: '#/components/schemas/Amount'
        currency:
          $ref: '#/components/schemas/CurrencyCode'
        status:
          description: "Status definitions: <br>
              1. RCVD: Received; payment received <br>
              2. PDNG: Pending; payment initiated <br>
              3. RJCT: Rejected; payment initiated and has been rejected  <br>
              4. ACSP: AcceptedSettlementInProcess; All preceding checks such as technical validation and customer profile are successful. Paymnet has been accepted for execution <br>
              5. ACSC: AcceptedSettlementCompleted; Settlement on the Debtor's account has been completed <br>
              6. ACCC: AcceptedCreditSettlementCompleted; Settlement on the Creditor's account has been completed"
          type: string
          enum: 
            - RCVD
            - PDNG
            - RJCT
            - ACSP
            - ACSC
            - ACCC
        error_code:
          description: 'Additional error codes. TODO: enumurate detailed error codes!'
          type: string
          enum: ["1000", "2000", "3000", "4000", "5000", "6000", "7000", "8000", "9000"]
        error_message:
          description: 'Additional error messages'
          type: string
          enum:
            - "1000: Payment request entity errors"
            - "2000: Payment address resolution errors of payer/payee"
            - "3000: Payment processing related errors on payer side"
            - "4000: Payment processing related errors on payee side"
            - "5000: Reserved for future use"
            - "6000: Reserved for future use"
            - "7000: Reserved for future use"
            - "8000: Reserved for future use"
            - "9000: Technical errors"
        additional_info:
          description: "Additional info for interfacing DPGs platforms to integrate, reconcile, etc., unstructured data."
          type: string
          maxLength: 1024
      required:
        - locale
        - reference_code
        - request_id
        - datetime
        - payer
        - payee
        - amount
        - currency
        - status
    PaymentAddress:
      description: "<br>
        1. Payment address is a normative represenation of a financial address represented as account@provider <br>
        3. Every payer/payee payment address must be resolved to an actual account number for processing the payment instruction<br>
        4. Few examples: <br>
            - uid@pymt-rail e.g 12345@bsp <br>
            - uid@id-provider e.g 12345@mosip <br>
            - mobile@mobile-provider e.g 12345@m-pesa
            - account-id@bank-psp-code e.g 12345@gtbank.rwanda <br>
            - account-no@ifsc-code.ifsc.npci e.g 12345@HDFC0000001.ifsc.npci <br>
            - user-id@psp-code e.g. joeuser@mypsp <br>
            - token@psp-code e.g ot123456@mypsp <br>
            - cdbc-id@cdbc e.g. 12345@DCash"
      type: string
      format: "^[a-zA-Z0-9.-]+@[a-zA-Z0-9.-]+$"
      example: 12345@mosip"
    BatchHeader:
      description: "Header to manage payment disbursement cycle"
      type: object
      properties:
        batch_id:
          type: string
          description: Unique id to manage payment disbursement cycle
        datetime:
          description: "Batch requested date-time"
          type: string
          format: date-time
          example: '2022-12-04T18:01:07+00:00'
        total_count:
          description: "Total no of payment instructions in the batch request"
          type: integer
          example: 20800
      required:
        - batch_id
        - datetime
        - total_count
    BatchStatusHeader:
      description: "Batch status header info to provide summary details on payment processing status"
      type: object
      properties:
        batch_id:
          type: string
          description: Unique id to manage payment disbursement cycle
        datetime:
          description: "Batch response date-time"
          type: string
          format: date-time
          example: '2022-12-04T18:01:07+00:00'
        total_count:
          description: "Total no of payment instructions in the batch request"
          type: integer
          example: 20800
        inprocess_count:
          description: "No of payment instructions in process state. Status codes: RCVD, ACSP"
          type: integer
          example: 450
        success_count:
          description: "Total no of payment instructions successfully processed. Status codes: ACSC, ACCC"
          type: integer
          example: 20300
        reject_count:
          description: "Total no of payment instructions failed to process. Status codes: RJCT"
          type: integer
          example: 50
      required:
        - batch_id
        - datetime
        - total_count
        - inprocess_count
        - success_count
        - reject_count
    PaymentFile:
      description: 'Payment disbursement file for bulk processing of Payment entity in csv format'
      type: object
      properties:
        batch_id:
          type: string
          description: Unique id to manage payment disbursement cycle
        datetime:
          description: "Batch requested date-time"
          type: string
          format: date-time
          example: '2022-12-04T18:01:07+00:00'
        total_count:
          description: "Total no of payment instructions in the batch request"
          type: integer
          example: 20800
        fileName:
          description: "payment instruction file representing Payment entity in csv format as *.txt file"
          type: string
          format: binary
      required:
        - batch_id
        - datetime
        - total_count
        - fileName
    PaymentStatusFile:
      description: 'Payment disbursement status for reconciliation at social protection system end representing PaymentStatus entity in csv file format'
      type: object
      properties:
        batch_id:
          type: string
          description: Unique id to manage payment disbursement cycle
        datetime:
          description: "Batch response date-time"
          type: string
          format: date-time
          example: '2022-12-04T18:01:07+00:00'
        total_count:
          description: "Total no of payment instructions in the batch request"
          type: integer
          example: 20800
        inprocess_count:
          description: "No of payment instructions in process state. Status codes: RCVD, ACSP"
          type: integer
          example: 450
        success_count:
          description: "Total no of payment instructions successfully processed. Status codes: ACSC, ACCC"
          type: integer
          example: 20300
        reject_count:
          description: "Total no of payment instructions failed to process. Status codes: RJCT"
          type: integer
          example: 50
        fileName:
          description: "payment disbursement status file representing PaymentStatus entity in csv format as *.txt file"
          type: string
          format: binary
      required: 
        - batch_id
        - datetime
        - total_count
        - inprocess_count
        - success_count
        - reject_count
        - fileName
    CurrencyCode:
      description: "<br>
        1. Currency code allocated as per ISO 4217 format.<br>
        2. Codes for the representation of currencies and funds."
      type: string
      pattern: '^[A-Z]{3,3}$'
      example: "SLL"
    Amount:
      description: Describes amount in decimal value format
      type: string
      pattern: '^\d{1,13}\.\d{1,2}$'
    LanguageCode:
      description: indicates language code. G2P Connect supports country codes as per ISO 639.3 standard
      type: string   
      pattern: '^[a-z]{3,3}$'
      example: "kri"
    TransactionId:
      description: ""
      type: object
      properties:
        transaction_id:
          type: string
          minLength: 0
          maxLength: 40
          example: "123456789020211216223812"
    ErrorResponse:
      type: object
      description: ""
      properties:
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
      required:
        - code
        - message
  responses:
    200SuccessResponse:
      description: ""
      headers:
        x-request-id:
          $ref: '#/components/headers/x-request-id'
        x-correlation-id:
          $ref: '#/components/headers/x-correlation-id'
        date:
          $ref: "#/components/headers/date"
        x-processing-time:
          $ref: "#/components/headers/x-processing-time"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/TransactionId"
    400ErrorResponse:
      description: "Syntactic errors <br>
       <b>code : message</b> <br>
        400-1000 : tbd <br>
        400-1001: tbd <br>"
      headers:
        x-request-id:
          $ref: '#/components/headers/x-request-id'
        x-correlation-id:
          $ref: '#/components/headers/x-correlation-id'
        date:
          $ref: "#/components/headers/date"
        x-processing-time:
          $ref: "#/components/headers/x-processing-time"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    500ErrorResponse:
      description: "Internal server error, Please retry with exponential backup strategies and contact tech support: <br>
       <b>code : message</b> <br>
        500-1000 : tbd <br>
        500-1001 : tbd <br>"
      headers:
        x-request-id:
          $ref: '#/components/headers/x-request-id'
        x-correlation-id:
          $ref: '#/components/headers/x-correlation-id'
        date:
          $ref: "#/components/headers/date"
        x-processing-time:
          $ref: "#/components/headers/x-processing-time"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
  headers:
    x-request-id:
      description: "echo back from request"
      schema:
        type: 'string'
        example: "18f484bd-3321-4754-b95e-8abed0c97b5d"
    x-correlation-id:
      description: "unique correlation id for each request "
      schema:
        type: 'string'
        example: "f16115fa-6c4a-4a8a-9856-08ea467f131b"
    date:
      description: "HTTP header format"
      schema:
        type: string
        example: "Tue, 06 Mar 2020 21:00:00 GMT"
    x-processing-time:
      description: 'api process time in ms'
      schema:
        type: string
        example: 12
    cache-control-nostore:
      required: true
      schema:
        type: string
        enum: ["no-store"]
        example: "no-store"
    cache-control-private:
      required: true
      schema:
        type: string
        enum: ["private"]
        example: "private"
    pragma:
      required: true
      schema:
        type: string
        example: "no-cache"
  parameters:
    x-request-id:
      in: header
      name: x-request-id
      description: "x-request-id to correlate every request across backend services"
      required: true
      schema:
        type: string
        example: "18f484bd-3321-4754-b95e-8abed0c97b5d"
    date:
      in: header
      name: date
      description: "request timestamp in HTTP Date format - Tue, 06 Mar 2020 21:00:00 GMT"
      required: true
      schema:
        type: string
        example: "Tue, 06 Mar 2020 21:00:00 GMT"
    accept-language:
      in: header
      name: accept-language
      description: "Default value: en"
      required: false
      schema:
        type: string
        example: "en"
    transaction_id:
      in: path
      name: transaction_id
      description: "transaction id"
      required: true
      schema:
        type: string
        example: "123456789020211216223812"
  securitySchemes:
    Authorization:
      description: "User/System authenticated access token; (jwt bearer) token returned from implementing system's authentication/token api end points. All systems must implement token api."
      type: http
      scheme: bearer
      bearerFormat: jwt
    x-access-token:
      description: "Systems authenticated using client id & secrect using gateway's session token apis"    
      type: http
      scheme: bearer
      bearerFormat: jwt
      